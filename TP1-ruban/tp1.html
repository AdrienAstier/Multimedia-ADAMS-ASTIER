<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>TP1</title>
  <!-- voir https://greensock.com/docs/v3/Installation#installer -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
</head>
<body>
  <!-- dessin SVG créé et modifié par les scripts JS -->
  <svg xmlns="http://www.w3.org/2000/svg"
        width="100%" viewBox="0 0 200 200"
        id="dessin">
  </svg>

  <!-- utilisation du mixin SVGelement -->
  <script src="svgelement.js"></script>

  <script>
// compléments à la librairie Math
Math.radians = (deg) => deg * Math.PI / 180
Math.degrees = (rad) => rad / Math.PI * 180
    

    class Led {
        constructor(parent, x, y, radius) {
            this.led = parent.appendElement("circle", {
                cx: x,
                cy: y,
                r: radius - radius/16,
                fill: "gray",
                stroke: "black",
                'stroke-width': radius/8
            });
            this._state = 0;
        }

        get state() { return this._state; }
        set state(v) {
            const value = Math.max(0, Math.min(1, +v || 0));
            this._state = value;
            const color = gsap.utils.interpolate("gray", "rgb(255,0,0)", value);
            this.led.setAttribute("fill", color);
        }

        turnOn(timeline, duration = 0.1, position = ">") {
            timeline.to(this.led, { attr: { fill: "red" }, duration }, position);
        }
        turnOff(timeline, duration = 0.1, position = ">") {
            timeline.to(this.led, { attr: { fill: "gray" }, duration }, position);
        }
    }

    class LedRibbon {
        constructor(parent, {number, x, y, radius = 4, spacing = 0} = {}) {
            this.parent = parent;
            this.leds = [];
            const interval = radius * 2 + spacing;
            for (let i = 0; i < number; i++) {
                this.leds.push(new Led(parent, x + i * interval, y, radius));
            }
        }
    }

    const svg = SVGelement.fromSelector("#dessin");

    const TL = gsap.timeline();
    const led2 = new Led(svg, 70, 40, 10);
    TL.to(led2, { state: 1, duration: 1.0 });
    TL.to(led2, { state: 0, duration: 0.5 }, ">+2");

  </script>
</body>
</html>
